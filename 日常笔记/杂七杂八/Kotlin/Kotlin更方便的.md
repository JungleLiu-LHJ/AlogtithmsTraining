# Kotlin 3

## ä¸»æ„é€ å‡½æ•°

å¯ä»¥å†™å¯ä»¥ä¸å†™

```kotlin
class User constructor(name: String) {
    var name: String
    init {
        this.name = name
    }
}
```

> å…¶ä¸­ `init` ä»£ç å—æ˜¯ç´§è·Ÿåœ¨ä¸»æ„é€ å™¨ä¹‹åæ‰§è¡Œçš„ï¼Œè¿™æ˜¯å› ä¸ºä¸»æ„é€ å™¨æœ¬èº«æ²¡æœ‰ä»£ç ä½“ï¼Œ`init` ä»£ç å—å°±å……å½“äº†ä¸»æ„é€ å™¨ä»£ç ä½“çš„åŠŸèƒ½ã€‚

å“ªäº›éœ€è¦ç”¨æŸ±æ„é€ å‡½æ•°ï¼š

- å¿…é¡»æ€§ï¼šåˆ›å»ºç±»çš„å¯¹è±¡æ—¶ï¼Œä¸ç®¡ä½¿ç”¨å“ªä¸ªæ„é€ å™¨ï¼Œéƒ½éœ€è¦ä¸»æ„é€ å™¨çš„å‚ä¸
- ç¬¬ä¸€æ€§ï¼šåœ¨ç±»çš„åˆå§‹åŒ–è¿‡ç¨‹ä¸­ï¼Œé¦–å…ˆæ‰§è¡Œçš„å°±æ˜¯ä¸»æ„é€ å™¨

å½“æœ‰æ¬¡æ„é€ å‡½æ•°çš„æ—¶å€™ï¼š

```kotlin
class User constructor(var name: String) {
                                   // ğŸ‘‡  ğŸ‘‡ ç›´æ¥è°ƒç”¨ä¸»æ„é€ å™¨
    constructor(name: String, id: Int) : this(name) {
    }
                                                // ğŸ‘‡ é€šè¿‡ä¸Šä¸€ä¸ªæ¬¡æ„é€ å™¨ï¼Œé—´æ¥è°ƒç”¨ä¸»æ„é€ å™¨
    constructor(name: String, id: Int, age: Int) : this(name, id) {
    }
}
```



**å‡½æ•°ä½¿ç”¨`=`ç›´æ¥è¿”å›å€¼ã€‚**

```kotlin
fun sayHi(name: String) = println("Hi " + name)
```





## å­—ç¬¦ä¸²

```kotlin
val name = "world"
println("Hi ${name.length}") 
```



### åŸç”Ÿå­—ç¬¦ä¸²ï¼ˆraw stringï¼‰

æœ‰æ—¶å€™æˆ‘ä»¬ä¸å¸Œæœ›å†™è¿‡å¤šçš„è½¬ä¹‰å­—ç¬¦ï¼Œè¿™ç§æƒ…å†µ Kotlin é€šè¿‡ã€ŒåŸç”Ÿå­—ç¬¦ä¸²ã€æ¥å®ç°ã€‚

ç”¨æ³•å°±æ˜¯ä½¿ç”¨ä¸€å¯¹ `"""` å°†å­—ç¬¦ä¸²æ‹¬èµ·æ¥ï¼š

```kotlin
val name = "world"
val myName = "kotlin"
           ğŸ‘‡
val text = """
      Hi $name!
    My name is $myName.\n
"""
println(text)
```

```
      Hi world!
My name is kotlin.\n
```

åŸç”Ÿå­—ç¬¦ä¸²è¿˜å¯ä»¥é€šè¿‡ `trimMargin()` å‡½æ•°å»é™¤æ¯è¡Œå‰é¢çš„ç©ºæ ¼ï¼š

```kotlin
val text = """
     ğŸ‘‡ 
      |Hi world!
    |My name is kotlin.
""".trimMargin()
println(text)
```

```
Hi world!
My name is kotlin
```

è¿™é‡Œçš„ `trimMargin()` å‡½æ•°æœ‰ä»¥ä¸‹å‡ ä¸ªæ³¨æ„ç‚¹ï¼š

- `|` ç¬¦å·ä¸ºé»˜è®¤çš„è¾¹ç•Œå‰ç¼€ï¼Œå‰é¢åªèƒ½æœ‰ç©ºæ ¼ï¼Œå¦åˆ™ä¸ä¼šç”Ÿæ•ˆ
- è¾“å‡ºæ—¶ `|` ç¬¦å·ä»¥åŠå®ƒå‰é¢çš„ç©ºæ ¼éƒ½ä¼šè¢«åˆ é™¤
- è¾¹ç•Œå‰ç¼€è¿˜å¯ä»¥ä½¿ç”¨å…¶ä»–å­—ç¬¦ï¼Œæ¯”å¦‚ `trimMargin("/")`ï¼Œåªä¸è¿‡ä¸Šæ–¹çš„ä»£ç ä½¿ç”¨çš„æ˜¯å‚æ•°é»˜è®¤å€¼çš„è°ƒç”¨æ–¹å¼



## æ•°ç»„å’Œé›†åˆ

```kotlin
val intArray = intArrayOf(1, 2, 3)
val strList = listOf("a", "b", "c")
```

ä¸‹é¢æ˜¯å‡ ç§æ“ä½œå‡½æ•°ï¼š

* `forEach`ï¼šéå†æ¯ä¸€ä¸ªå…ƒç´ 

```kotlin
intArray.forEach { i ->
    print(i + " ")
}
```

* `filter`:è¿‡æ»¤å™¨

```kotlin
val newList: List = intArray.filter { i ->
    i != 1 // ğŸ‘ˆ è¿‡æ»¤æ‰æ•°ç»„ä¸­ç­‰äº 1 çš„å…ƒç´ 
}
```

* `map`:éå†æ¯ä¸ªå…ƒç´ å¹¶æ‰§è¡Œç»™å®šè¡¨è¾¾å¼ï¼ˆåƒæ»¤æ³¢å™¨ä¸€æ ·ï¼‰

```kotlin
val newList: List = intArray.map { i ->
    i + 1 // ğŸ‘ˆ æ¯ä¸ªå…ƒç´ åŠ  1
}
```

* `flatMap`ï¼šéå†æ¯ä¸ªå…ƒç´ ï¼Œå¹¶ä¸ºæ¯ä¸ªå…ƒç´ åˆ›å»ºæ–°çš„é›†åˆ

```kotlin
intArray.flatMap { i ->
    listOf("${i + 1}", "a") // ğŸ‘ˆ ç”Ÿæˆæ–°é›†åˆ
}
```



### Range



`val range: IntRange = 0..1000 `: [0,1000]

`val range: IntRange = 0 until 1000 `:[0.1000)

å¯ä»¥è®¾ç½®æ­¥é•¿ï¼š

```kotlin
val range = 0..1000
//               ğŸ‘‡ æ­¥é•¿ä¸º 2ï¼Œè¾“å‡ºï¼š0, 2, 4, 6, 8, 10,....1000,
for (i in range step 2) {
    print("$i, ")
}
```

é€’å‡åŒºé—´ï¼š

```kotlin
for (i in 4 downTo 1) {
    print("$i, ")
}
```



### Sequence

æƒ°æ€§é›†åˆ

```kotlin
val sequence = sequenceOf(1, 2, 3, 4)
val result: List = sequence
    .map { i ->
        println("Map $i")
        i * 2 
    }
    .filter { i ->
        println("Filter $i")
        i % 3  == 0 
    }
ğŸ‘‡
println(result.first()) // ğŸ‘ˆ åªå–é›†åˆçš„ç¬¬ä¸€ä¸ªå…ƒç´ 
```

- æƒ°æ€§çš„æ¦‚å¿µé¦–å…ˆå°±æ˜¯è¯´åœ¨ã€ŒğŸ‘‡ã€æ ‡æ³¨ä¹‹å‰çš„ä»£ç è¿è¡Œæ—¶ä¸ä¼šç«‹å³æ‰§è¡Œï¼Œå®ƒåªæ˜¯å®šä¹‰äº†ä¸€ä¸ªæ‰§è¡Œæµç¨‹ï¼Œåªæœ‰ `result` è¢«ä½¿ç”¨åˆ°çš„æ—¶å€™æ‰ä¼šæ‰§è¡Œ

- å½“ã€ŒğŸ‘‡ã€çš„ `println` æ‰§è¡Œæ—¶æ•°æ®å¤„ç†æµç¨‹æ˜¯è¿™æ ·çš„ï¼š

  - å–å‡ºå…ƒç´  1 -> map ä¸º 2 -> filter åˆ¤æ–­ 2 æ˜¯å¦èƒ½è¢« 3 æ•´é™¤
  - å–å‡ºå…ƒç´  2 -> map ä¸º 4 -> filter åˆ¤æ–­ 4 æ˜¯å¦èƒ½è¢« 3 æ•´é™¤
  - ...

  æƒ°æ€§æŒ‡å½“å‡ºç°æ»¡è¶³æ¡ä»¶çš„ç¬¬ä¸€ä¸ªå…ƒç´ çš„æ—¶å€™ï¼Œ`Sequence` å°±ä¸ä¼šæ‰§è¡Œåé¢çš„å…ƒç´ éå†äº†ï¼Œå³è·³è¿‡äº† `4` çš„éå†

è€Œæ™®é€šçš„`list`æ˜¯æ²¡æœ‰æƒ°æ€§çš„ï¼Œä¼šéå†æ‰€æœ‰çš„çš„å…ƒç´ 

`sequence`çš„å®ç°çš„ä¼˜ç‚¹ï¼š

- ä¸€æ—¦æ»¡è¶³éå†é€€å‡ºçš„æ¡ä»¶ï¼Œå°±å¯ä»¥çœç•¥åç»­ä¸å¿…è¦çš„éå†è¿‡ç¨‹ã€‚
- åƒ `List` è¿™ç§å®ç° `Iterable` æ¥å£çš„é›†åˆç±»ï¼Œæ¯è°ƒç”¨ä¸€æ¬¡å‡½æ•°å°±ä¼šç”Ÿæˆä¸€ä¸ªæ–°çš„ `Iterable`ï¼Œä¸‹ä¸€ä¸ªå‡½æ•°å†åŸºäºæ–°çš„ `Iterable` æ‰§è¡Œï¼Œæ¯æ¬¡å‡½æ•°è°ƒç”¨äº§ç”Ÿçš„ä¸´æ—¶ `Iterable` ä¼šå¯¼è‡´é¢å¤–çš„å†…å­˜æ¶ˆè€—ï¼Œè€Œ `Sequence` åœ¨æ•´ä¸ªæµç¨‹ä¸­åªæœ‰ä¸€ä¸ªã€‚



## æ¡ä»¶æ§åˆ¶



```kotlin
val max = if (a > b) a else b
```

> æ³¨æ„ï¼šKotlinå¼ƒç”¨äº†ä¸‰å…ƒè¿ç®—ç¬¦ï¼ˆæ¡ä»¶ï¼Ÿç„¶åï¼šå¦åˆ™ï¼‰

å½“ç„¶ï¼Œä¸Šé¢çš„aã€bä¹Ÿå¯ä»¥æ›¿æ¢æˆä»£ç å—



```kotlin
when (x) {
    ğŸ‘‡
    1, 2 -> print("x == 1 or x == 2")
    else -> print("else")
}
```

å¯¹æ•°ç»„çš„éå†ï¼š

```kotlin
val array = intArrayOf(1, 2, 3, 4)
          ğŸ‘‡
for (item in array) {
    ...
}
```

è¿™é‡Œä¸ Java æœ‰å‡ å¤„ä¸åŒï¼š

- åœ¨ Kotlin ä¸­ï¼Œè¡¨ç¤ºå•ä¸ªå…ƒç´ çš„ `item` ï¼Œä¸ç”¨æ˜¾å¼çš„å£°æ˜ç±»å‹
- Kotlin ä½¿ç”¨çš„æ˜¯ `in` å…³é”®å­—ï¼Œè¡¨ç¤º `item` æ˜¯ `array` é‡Œé¢çš„ä¸€ä¸ªå…ƒç´ 



### ï¼Ÿ.å’Œï¼Ÿ..

```kotlin
var length: Int = str?.length
//                ğŸ‘† ï¼ŒIDE æŠ¥é”™ï¼ŒType mismatch. Required:Int. Found:Int?
val length: Int = str?.length ?: -1  
//        å¦‚æœå·¦ä¾§è¡¨è¾¾å¼str?.lengthä¸ºç©ºï¼Œåˆ™è¿”å›-1
```

```kotlin
fun validate(user: User) {
    val id = user.id ?: return // ğŸ‘ˆ éªŒè¯ user.id æ˜¯å¦ä¸ºç©ºï¼Œä¸ºç©ºæ—¶ return 
}
```



### `==`å’Œ`===`



- `==` ï¼šå¯ä»¥å¯¹åŸºæœ¬æ•°æ®ç±»å‹ä»¥åŠ `String` ç­‰ç±»å‹è¿›è¡Œå†…å®¹æ¯”è¾ƒï¼Œç›¸å½“äº Java ä¸­çš„ `equals`
- `===` ï¼šå¯¹å¼•ç”¨çš„å†…å­˜åœ°å€è¿›è¡Œæ¯”è¾ƒï¼Œç›¸å½“äº Java ä¸­çš„ `==`

```kotlin
val str1 = "123"
val str2 = "123"
println(str1 == str2) // ğŸ‘ˆ å†…å®¹ç›¸ç­‰ï¼Œè¾“å‡ºï¼štrue

val str1= "å­—ç¬¦ä¸²"
val str2 = str1
val str3 = str1
print(str2 === str3) // ğŸ‘ˆ å¼•ç”¨åœ°å€ç›¸ç­‰ï¼Œè¾“å‡ºï¼štrue
```





å±€éƒ¨å‡½æ•°ï¼ˆlocal functionï¼‰



